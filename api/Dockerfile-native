# Build stage
FROM container-registry.oracle.com/graalvm/native-image:25 AS builder
WORKDIR /app
COPY . /app
RUN --mount=type=secret,id=codeartifact_token ./gradlew :api:nativeCompile -PcodeArtifactAuthToken=$(cat /run/secrets/codeartifact_token)

# Runtime stage
FROM docker.io/debian:stable-slim
WORKDIR /app
COPY --from=builder /app/api/build/native/nativeCompile/api /app/api
EXPOSE 8080
ENTRYPOINT ["/app/api"]
